<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.4.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1716016128399-1" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="book" />
            </not>
        </preConditions>
        <createTable tableName="book">
            <column autoIncrement="true" name="book_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_book"/>
            </column>
            <column name="created_at" type="DATETIME"/>
            <column name="updated_at" type="DATETIME"/>
            <column name="book_name" type="VARCHAR(255)"/>
            <column name="user_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1716016128399-2" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="follow" />
            </not>
        </preConditions>
        <createTable tableName="follow">
            <column autoIncrement="true" name="follow_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_follow"/>
            </column>
            <column name="created_at" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="followee_user_id" type="BIGINT"/>
            <column name="follower_user_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1716016128399-3" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="image_info" />
            </not>
        </preConditions>
        <createTable tableName="image_info">
            <column autoIncrement="true" name="image_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_image_info"/>
            </column>
            <column name="image_url" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1716016128399-4" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="like" />
            </not>
        </preConditions>
        <createTable tableName="like">
            <column autoIncrement="true" name="like_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_like"/>
            </column>
            <column name="created_at" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT"/>
            <column name="page_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1716016128399-5" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="page" />
            </not>
        </preConditions>
        <createTable tableName="page">
            <column autoIncrement="true" name="page_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_page"/>
            </column>
            <column name="created_at" type="DATETIME"/>
            <column name="updated_at" type="DATETIME"/>
            <column name="page_title" type="VARCHAR(255)"/>
            <column name="page_content" type="CLOB"/>
            <column name="modified" type="BOOLEAN"/>
            <column name="user_id" type="BIGINT"/>
            <column name="root_id" type="BIGINT"/>
            <column name="prev_id" type="BIGINT"/>
            <column name="next_id" type="BIGINT"/>
            <column name="book_id" type="BIGINT"/>
            <column name="is_scrapped" type="BOOLEAN"/>
        </createTable>
    </changeSet>
    <changeSet id="1716016128399-6" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="refresh_token" />
            </not>
        </preConditions>
        <createTable tableName="refresh_token">
            <column name="token_key" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_refresh_token"/>
            </column>
            <column name="value" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1716016128399-7" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="scrap" />
            </not>
        </preConditions>
        <createTable tableName="scrap">
            <column autoIncrement="true" name="scrap_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_scrap"/>
            </column>
            <column name="created_at" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT"/>
            <column name="page_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1716016128399-8" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user" />
            </not>
        </preConditions>
        <createTable tableName="user">
            <column autoIncrement="true" name="user_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_user"/>
            </column>
            <column name="created_at" type="DATETIME"/>
            <column name="updated_at" type="DATETIME"/>
            <column name="user_email" type="VARCHAR(255)"/>
            <column name="user_passwd" type="VARCHAR(255)"/>
            <column name="user_image" type="VARCHAR(255)"/>
            <column name="user_name" type="VARCHAR(255)"/>
            <column name="user_nickname" type="VARCHAR(255)"/>
            <column name="user_role" type="VARCHAR(255)"/>
            <column name="last_login_at" type="DATETIME"/>
        </createTable>
    </changeSet>
    <changeSet id="1716016128399-9" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_BOOK_ON_USER" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="book" constraintName="FK_BOOK_ON_USER"
                                 referencedColumnNames="user_id" referencedTableName="user"/>
    </changeSet>
    <changeSet id="1716016128399-10" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_FOLLOW_ON_FOLLOWEE_USER" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="followee_user_id" baseTableName="follow"
                                 constraintName="FK_FOLLOW_ON_FOLLOWEE_USER" referencedColumnNames="user_id"
                                 referencedTableName="user"/>
    </changeSet>
    <changeSet id="1716016128399-11" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_FOLLOW_ON_FOLLOWER_USER" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="follower_user_id" baseTableName="follow"
                                 constraintName="FK_FOLLOW_ON_FOLLOWER_USER" referencedColumnNames="user_id"
                                 referencedTableName="user"/>
    </changeSet>
    <changeSet id="1716016128399-12" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_LIKE_ON_PAGE" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="page_id" baseTableName="like" constraintName="FK_LIKE_ON_PAGE"
                                 referencedColumnNames="page_id" referencedTableName="page"/>
    </changeSet>
    <changeSet id="1716016128399-13" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_LIKE_ON_USER" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="like" constraintName="FK_LIKE_ON_USER"
                                 referencedColumnNames="user_id" referencedTableName="user"/>
    </changeSet>
    <changeSet id="1716016128399-14" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_PAGE_ON_BOOK" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="book_id" baseTableName="page" constraintName="FK_PAGE_ON_BOOK"
                                 referencedColumnNames="book_id" referencedTableName="book"/>
    </changeSet>
    <changeSet id="1716016128399-15" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_PAGE_ON_USER" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="page" constraintName="FK_PAGE_ON_USER"
                                 referencedColumnNames="user_id" referencedTableName="user"/>
    </changeSet>
    <changeSet id="1716016128399-16" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_SCRAP_ON_PAGE" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="page_id" baseTableName="scrap" constraintName="FK_SCRAP_ON_PAGE"
                                 referencedColumnNames="page_id" referencedTableName="page"/>
    </changeSet>
    <changeSet id="1716016128399-17" author="_sloss (generated)">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="FK_SCRAP_ON_USER" />
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="scrap" constraintName="FK_SCRAP_ON_USER"
                                 referencedColumnNames="user_id" referencedTableName="user"/>
    </changeSet>

</databaseChangeLog>